# Chrome翻訳API STATUS_BREAKPOINTエラー デバッグ提案書

## 概要
Chrome開発者チームと協力してSTATUS_BREAKPOINTエラーの原因究明を行うため、専用のデバッグ版HTMLファイル（index_debug.html）を作成します。このファイルにより、ユーザーが簡単にデバッグテストに参加できる環境を提供します。

## デバッグ版の主要機能

### 1. 自動翻訳テスト機能
- **音声認識機能を無効化**し、代わりに事前定義されたテストテキストを自動で順番に翻訳
- **テスト用テキスト（10種類）**: 配信者がよく使用する日常的な発話を想定
  1. 「今日も配信始めていきます！」
  2. 「コメントありがとうございます」
  3. 「この敵強すぎるんだけど！」
  4. 「みんな調子はどうですか？」
  5. 「次はこのゲームやってみます」
  6. 「ちょっと休憩入れますね」
  7. 「今のプレイすごかったでしょ」
  8. 「フォローよろしくお願いします」
  9. 「スパチャありがとうございます」
  10. 「それではまた次回の配信で！」

### 2. 自動実行設定
- **2秒間隔**で次のテキストを自動翻訳
- 10個のテキストを順番に繰り返し実行
- 開始/停止ボタンで制御可能

### 3. リアルタイム統計表示
- **翻訳カウンター**
  - 言語ペア別の翻訳回数（例：ja→en: 150回）
  - 総翻訳回数
  - 1分あたりの翻訳回数
- **経過時間表示**
  - テスト開始からの経過時間（時:分:秒）
  - 最後のエラーからの経過時間
- **パフォーマンス指標**
  - 平均翻訳時間
  - 最大/最小翻訳時間
  - メモリ使用量（可能な場合）

### 4. ログ記録システム

#### 4.1 LocalStorageベースのログ保存
- **ログ形式**:
  ```json
  {
    "timestamp": "2025-01-11T10:30:45.123Z",
    "type": "translation|error|info",
    "sourceText": "テキスト内容",
    "sourceLang": "ja",
    "targetLang": "en",
    "translatedText": "翻訳結果",
    "duration": 123,
    "errorDetails": "エラー詳細（該当する場合）"
  }
  ```

#### 4.2 ログ管理機能
- **循環バッファ方式**: 最新1000件のログを保持
- **エクスポート機能**: JSON/CSV形式でダウンロード可能
- **フィルタリング**: エラーのみ、特定言語ペアのみ等
- **リアルタイム表示**: 最新20件のログを画面に表示

### 5. エラー検出機能
- **STATUS_BREAKPOINTエラーの検出**:
  - try-catchでのエラーキャッチ
  - Chrome Translation APIのエラーイベント監視
  - 翻訳応答時間の異常検出（タイムアウト）
- **エラー時の自動処理**:
  - 詳細なエラー情報をログに記録
  - エラー発生時刻と前後のコンテキストを保存
  - 可能であれば自動でテスト継続

### 6. デバッグ専用UI

#### 6.1 コントロールパネル
```
┌─────────────────────────────────────┐
│ Chrome翻訳API デバッグモード        │
├─────────────────────────────────────┤
│ [開始] [停止] [ログクリア] [エクスポート] │
│                                     │
│ 翻訳間隔: [2]秒  ループ: [✓]       │
│ 翻訳元: [日本語▼] → [英語▼]       │
├─────────────────────────────────────┤
│ 統計情報                            │
│ ・総翻訳回数: 1,234回              │
│ ・経過時間: 01:23:45               │
│ ・エラー回数: 2回                  │
│ ・最終エラー: 45分前               │
├─────────────────────────────────────┤
│ 言語ペア別カウンター               │
│ ja→en: 423  ja→zh: 312            │
│ ja→ko: 289  ja→es: 210            │
└─────────────────────────────────────┘
```

#### 6.2 ログビューア
```
┌─────────────────────────────────────┐
│ リアルタイムログ (最新20件)         │
├─────────────────────────────────────┤
│ 10:30:45 [OK] ja→en 翻訳成功 (120ms)│
│ 10:30:43 [OK] ja→zh 翻訳成功 (145ms)│
│ 10:30:41 [ERR] STATUS_BREAKPOINT    │
│ ...                                 │
└─────────────────────────────────────┘
```

## 実装上の注意点

### 必須要件
1. **index_debug.htmlのみを変更** - main.htmlや他のファイルは一切変更しない
2. **既存機能への影響なし** - 通常版（index.html）の動作に影響を与えない
3. **簡単なアクセス** - URLを開くだけでテスト開始可能

### 技術的実装方法
1. **iframe内のmain.htmlをそのまま使用**
2. **postMessageで翻訳リクエストを送信**
3. **音声認識の代わりにsetIntervalでテキスト送信**
4. **LocalStorageでデバッグデータを永続化**

### データ収集項目
- 翻訳成功/失敗の回数と割合
- エラー発生までの翻訳回数
- エラー発生時の言語ペア
- エラー前後の翻訳パターン
- ブラウザ情報（Chrome バージョン等）

## 期待される成果
1. STATUS_BREAKPOINTエラーの再現条件特定
2. エラー発生パターンの統計的分析
3. Chrome開発チームへの詳細なバグレポート提供
4. ユーザーコミュニティからのフィードバック収集

## 追加提案

### オプション機能
1. **ストレステストモード**: 翻訳間隔を0.5秒に短縮して負荷テスト
2. **言語ランダムモード**: 翻訳先言語をランダムに切り替え
3. **WebSocketログ送信**: リアルタイムで開発者サーバーにログ送信（要サーバー実装）
4. **グラフ表示**: Chart.jsで翻訳回数やエラー率をグラフ化
5. **自動レポート生成**: テスト終了時に要約レポートを自動生成

### セキュリティ考慮事項
- 個人情報を含むテキストは使用しない
- ログデータは暗号化せずローカル保存（機密情報なし）
- エクスポートデータには警告表示を含める

この提案により、Chrome開発チームと協力してSTATUS_BREAKPOINTエラーの根本原因を特定し、解決に向けた具体的なデータを提供できます。