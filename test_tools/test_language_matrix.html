<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Chrome Translation API 言語対応マトリックス</title>
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status {
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .status.checking {
            background: #fff3cd;
            color: #856404;
        }
        .status.complete {
            background: #d4edda;
            color: #155724;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 12px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        th {
            background: #f8f9fa;
            font-weight: bold;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        th.source {
            background: #e3f2fd;
        }
        td.source {
            background: #f5f5f5;
            font-weight: bold;
        }
        .available {
            background: #c8e6c9;
            color: #2e7d32;
            font-weight: bold;
        }
        .downloadable {
            background: #fff9c4;
            color: #f57f17;
        }
        .unavailable {
            background: #ffebee;
            color: #c62828;
        }
        .same {
            background: #e0e0e0;
            color: #757575;
        }
        .legend {
            display: flex;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .legend-box {
            width: 20px;
            height: 20px;
            border: 1px solid #ccc;
        }
        #progress {
            margin: 20px 0;
        }
        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        .summary {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        button {
            background: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover {
            background: #45a049;
        }
    </style>
    <script src="chrome_translator_v2.js"></script>
</head>
<body>
    <div class="container">
        <h1>🌐 Chrome Translation API 言語対応マトリックス</h1>
        <p style="text-align: center;">音声認識字幕ちゃんで使用可能な言語ペアを総チェック</p>
        
        <div id="status" class="status checking">
            初期化中...
        </div>
        
        <div>
            <button onclick="checkAllLanguages()">全言語ペアをチェック</button>
            <button onclick="checkFromJapanese()">日本語からの翻訳のみチェック</button>
            <button onclick="exportResults()">結果をエクスポート</button>
        </div>
        
        <div id="progress" style="display: none;">
            <div class="progress-bar">
                <div id="progress-fill" class="progress-fill">0%</div>
            </div>
            <p id="progress-text" style="text-align: center;"></p>
        </div>
        
        <div class="legend">
            <div class="legend-item">
                <div class="legend-box available"></div>
                <span>即座に利用可能 (available)</span>
            </div>
            <div class="legend-item">
                <div class="legend-box downloadable"></div>
                <span>ダウンロード後利用可能 (downloadable)</span>
            </div>
            <div class="legend-item">
                <div class="legend-box unavailable"></div>
                <span>利用不可 (no)</span>
            </div>
            <div class="legend-item">
                <div class="legend-box same"></div>
                <span>同一言語</span>
            </div>
        </div>
        
        <div id="summary" class="summary" style="display: none;"></div>
        
        <div id="results"></div>
    </div>
    
    <script>
        // 音声認識字幕ちゃんがサポートする言語リスト
        const jimakuChanLanguages = [
            { code: 'ja', name: '日本語', chromeCode: 'ja' },
            { code: 'en', name: '英語', chromeCode: 'en' },
            { code: 'ko', name: '韓国語', chromeCode: 'ko' },
            { code: 'zh-CN', name: '中国語(簡)', chromeCode: 'zh' },
            { code: 'zh-TW', name: '中国語(繁)', chromeCode: 'zh-Hant' },
            { code: 'zh-HK', name: '香港語', chromeCode: 'zh-Hant' },
            { code: 'fr', name: 'フランス語', chromeCode: 'fr' },
            { code: 'it', name: 'イタリア語', chromeCode: 'it' },
            { code: 'de', name: 'ドイツ語', chromeCode: 'de' },
            { code: 'tr', name: 'トルコ語', chromeCode: 'tr' },
            { code: 'sv', name: 'スウェーデン語', chromeCode: 'sv' },
            { code: 'pl', name: 'ポーランド語', chromeCode: 'pl' },
            { code: 'uk', name: 'ウクライナ語', chromeCode: 'uk' },
            { code: 'ru', name: 'ロシア語', chromeCode: 'ru' },
            { code: 'es', name: 'スペイン語', chromeCode: 'es' },
            { code: 'pt', name: 'ポルトガル語', chromeCode: 'pt' },
            { code: 'nl', name: 'オランダ語', chromeCode: 'nl' },
            { code: 'id', name: 'インドネシア語', chromeCode: 'id' },
            { code: 'vi', name: 'ベトナム語', chromeCode: 'vi' },
            { code: 'th', name: 'タイ語', chromeCode: 'th' },
            { code: 'ar', name: 'アラビア語', chromeCode: 'ar' },
            { code: 'so', name: 'ソマリ語', chromeCode: 'so' },
            { code: 'el', name: 'ギリシャ語', chromeCode: 'el' }
        ];
        
        let results = {};
        
        async function initializeAPI() {
            const statusEl = document.getElementById('status');
            
            if (!('Translator' in self)) {
                statusEl.textContent = '❌ Chrome Translation APIは利用できません';
                statusEl.className = 'status error';
                return false;
            }
            
            if (window.chromeTranslator) {
                await window.chromeTranslator.checkAvailability();
                if (window.chromeTranslator.isAvailable) {
                    statusEl.textContent = '✅ Chrome Translation API準備完了';
                    statusEl.className = 'status complete';
                    return true;
                }
            }
            
            statusEl.textContent = '❌ Chrome Translation APIの初期化に失敗';
            statusEl.className = 'status error';
            return false;
        }
        
        async function checkLanguagePair(sourceLang, targetLang) {
            try {
                const availability = await Translator.availability({
                    sourceLanguage: sourceLang.chromeCode,
                    targetLanguage: targetLang.chromeCode
                });
                return availability;
            } catch (error) {
                console.error(`エラー: ${sourceLang.code} → ${targetLang.code}`, error);
                return 'error';
            }
        }
        
        async function checkAllLanguages() {
            const apiReady = await initializeAPI();
            if (!apiReady) return;
            
            const progressEl = document.getElementById('progress');
            const progressFillEl = document.getElementById('progress-fill');
            const progressTextEl = document.getElementById('progress-text');
            const statusEl = document.getElementById('status');
            
            progressEl.style.display = 'block';
            statusEl.textContent = 'チェック中...';
            statusEl.className = 'status checking';
            
            results = {};
            const total = jimakuChanLanguages.length * jimakuChanLanguages.length;
            let current = 0;
            
            // 各言語ペアをチェック
            for (const sourceLang of jimakuChanLanguages) {
                results[sourceLang.code] = {};
                
                for (const targetLang of jimakuChanLanguages) {
                    current++;
                    const progress = Math.round((current / total) * 100);
                    progressFillEl.style.width = progress + '%';
                    progressFillEl.textContent = progress + '%';
                    progressTextEl.textContent = `チェック中: ${sourceLang.name} → ${targetLang.name}`;
                    
                    if (sourceLang.code === targetLang.code) {
                        results[sourceLang.code][targetLang.code] = 'same';
                    } else {
                        const availability = await checkLanguagePair(sourceLang, targetLang);
                        results[sourceLang.code][targetLang.code] = availability;
                        
                        // レート制限を避けるため少し待機
                        await new Promise(resolve => setTimeout(resolve, 50));
                    }
                }
            }
            
            statusEl.textContent = '✅ チェック完了';
            statusEl.className = 'status complete';
            displayResults();
            showSummary();
        }
        
        async function checkFromJapanese() {
            const apiReady = await initializeAPI();
            if (!apiReady) return;
            
            const progressEl = document.getElementById('progress');
            const progressFillEl = document.getElementById('progress-fill');
            const progressTextEl = document.getElementById('progress-text');
            const statusEl = document.getElementById('status');
            
            progressEl.style.display = 'block';
            statusEl.textContent = 'チェック中...';
            statusEl.className = 'status checking';
            
            results = { 'ja': {} };
            const sourceLang = jimakuChanLanguages.find(l => l.code === 'ja');
            const total = jimakuChanLanguages.length;
            let current = 0;
            
            for (const targetLang of jimakuChanLanguages) {
                current++;
                const progress = Math.round((current / total) * 100);
                progressFillEl.style.width = progress + '%';
                progressFillEl.textContent = progress + '%';
                progressTextEl.textContent = `チェック中: 日本語 → ${targetLang.name}`;
                
                if (targetLang.code === 'ja') {
                    results['ja'][targetLang.code] = 'same';
                } else {
                    const availability = await checkLanguagePair(sourceLang, targetLang);
                    results['ja'][targetLang.code] = availability;
                    
                    await new Promise(resolve => setTimeout(resolve, 50));
                }
            }
            
            statusEl.textContent = '✅ チェック完了';
            statusEl.className = 'status complete';
            displayResults();
            showSummary();
        }
        
        function displayResults() {
            const resultsEl = document.getElementById('results');
            
            let html = '<h2>言語対応表</h2>';
            html += '<div style="overflow-x: auto;">';
            html += '<table>';
            
            // ヘッダー行
            html += '<tr>';
            html += '<th>ソース＼ターゲット</th>';
            for (const lang of jimakuChanLanguages) {
                html += `<th>${lang.name}<br><small>${lang.code}</small></th>`;
            }
            html += '</tr>';
            
            // データ行
            for (const sourceLang of jimakuChanLanguages) {
                if (!results[sourceLang.code]) continue;
                
                html += '<tr>';
                html += `<td class="source">${sourceLang.name}<br><small>${sourceLang.code}</small></td>`;
                
                for (const targetLang of jimakuChanLanguages) {
                    const result = results[sourceLang.code][targetLang.code];
                    let className = '';
                    let text = '';
                    
                    if (result === 'same') {
                        className = 'same';
                        text = '－';
                    } else if (result === 'available') {
                        className = 'available';
                        text = '✅';
                    } else if (result === 'downloadable') {
                        className = 'downloadable';
                        text = '⬇️';
                    } else {
                        className = 'unavailable';
                        text = '❌';
                    }
                    
                    html += `<td class="${className}">${text}</td>`;
                }
                html += '</tr>';
            }
            
            html += '</table>';
            html += '</div>';
            
            resultsEl.innerHTML = html;
        }
        
        function showSummary() {
            const summaryEl = document.getElementById('summary');
            
            let availableCount = 0;
            let downloadableCount = 0;
            let unavailableCount = 0;
            let totalPairs = 0;
            
            for (const source in results) {
                for (const target in results[source]) {
                    if (results[source][target] !== 'same') {
                        totalPairs++;
                        if (results[source][target] === 'available') availableCount++;
                        else if (results[source][target] === 'downloadable') downloadableCount++;
                        else unavailableCount++;
                    }
                }
            }
            
            let html = '<h3>📊 統計情報</h3>';
            html += `<p>チェックした言語ペア数: ${totalPairs}</p>`;
            html += `<p>✅ 即座に利用可能: ${availableCount} (${Math.round(availableCount/totalPairs*100)}%)</p>`;
            html += `<p>⬇️ ダウンロード後利用可能: ${downloadableCount} (${Math.round(downloadableCount/totalPairs*100)}%)</p>`;
            html += `<p>❌ 利用不可: ${unavailableCount} (${Math.round(unavailableCount/totalPairs*100)}%)</p>`;
            
            // 人気の言語ペアの状況
            const popularPairs = [
                { from: 'ja', to: 'en', name: '日本語→英語' },
                { from: 'ja', to: 'ko', name: '日本語→韓国語' },
                { from: 'ja', to: 'zh-CN', name: '日本語→中国語(簡)' },
                { from: 'en', to: 'ja', name: '英語→日本語' },
                { from: 'ko', to: 'ja', name: '韓国語→日本語' }
            ];
            
            html += '<h4>主要な言語ペアの状況:</h4>';
            html += '<ul>';
            for (const pair of popularPairs) {
                if (results[pair.from] && results[pair.from][pair.to]) {
                    const status = results[pair.from][pair.to];
                    let statusText = '';
                    if (status === 'available') statusText = '✅ 即座に利用可能';
                    else if (status === 'downloadable') statusText = '⬇️ ダウンロード後利用可能';
                    else statusText = '❌ 利用不可';
                    
                    html += `<li>${pair.name}: ${statusText}</li>`;
                }
            }
            html += '</ul>';
            
            summaryEl.innerHTML = html;
            summaryEl.style.display = 'block';
        }
        
        function exportResults() {
            if (Object.keys(results).length === 0) {
                alert('まず言語ペアをチェックしてください');
                return;
            }
            
            let csv = 'ソース言語,ターゲット言語,状態\n';
            
            for (const source in results) {
                for (const target in results[source]) {
                    const sourceName = jimakuChanLanguages.find(l => l.code === source)?.name || source;
                    const targetName = jimakuChanLanguages.find(l => l.code === target)?.name || target;
                    csv += `${sourceName},${targetName},${results[source][target]}\n`;
                }
            }
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'chrome_translation_languages.csv';
            link.click();
        }
        
        // 初期化
        window.addEventListener('load', () => {
            initializeAPI();
        });
    </script>
</body>
</html>